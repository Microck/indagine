---
phase: 04-demo-submit
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [docs/architecture.png]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "docs/architecture.png exists and is a valid image file >5KB"
    - "Rendered diagram shows all 8 agents (BookingAgent, SearchAgent, SummaryAgent, FailureDetector, TraceAnalyzer, ToolAnalyzer, DiagnosisEngine, FixGenerator) with data flow arrows"
  artifacts:
    - path: "docs/architecture.png"
      provides: "Rendered architecture diagram for submission"
      min_lines: null
  key_links:
    - from: "docs/architecture.mmd"
      to: "docs/architecture.png"
      via: "Mermaid rendering pipeline"
      pattern: "architecture\\.png"
---

<objective>
Render the existing `docs/architecture.mmd` Mermaid source to `docs/architecture.png` for hackathon submission.

Purpose: Close verification gap 1 — the Mermaid source exists and is complete (29 lines, 8 agents + data flow) but the required rendered PNG artifact is missing. DEMO-04 requires a visual architecture diagram.
Output: `docs/architecture.png` — a readable PNG showing all 8 Indagine agents and their data flow.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/04-demo-submit/04-VERIFICATION.md
@docs/architecture.mmd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Render architecture.mmd to PNG using Playwright browser</name>
  <files>docs/architecture.png</files>
  <action>
Render `docs/architecture.mmd` to `docs/architecture.png`. The Mermaid CLI (`npx @mermaid-js/mermaid-cli`) is installed (v11.12.0) but the default Puppeteer Chrome headless shell fails in this environment.

**Strategy — use a Node.js script with Playwright's Chromium browser directly:**

1. Create a temporary Node.js script (e.g., `/tmp/render_mermaid.mjs`) that:
   - Reads `docs/architecture.mmd` content
   - Launches Playwright's Chromium in headless mode from `/home/ubuntu/.cache/ms-playwright/chromium-1208/chrome-linux/chrome` with args `['--no-sandbox', '--disable-gpu']`
   - Creates an HTML page that loads the Mermaid library from CDN (`https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js`) and renders the diagram
   - Waits for the SVG to render, takes a screenshot of the diagram element (or full page)
   - Saves to `docs/architecture.png`

2. If the Playwright API approach fails, try the Mermaid CLI with explicit Playwright browser path:
   ```bash
   npx @mermaid-js/mermaid-cli -i docs/architecture.mmd -o docs/architecture.png \
     --puppeteerConfigFile /tmp/mermaid-config.json
   ```
   Where `/tmp/mermaid-config.json` contains:
   ```json
   {
     "executablePath": "/home/ubuntu/.cache/ms-playwright/chromium-1208/chrome-linux/chrome",
     "args": ["--no-sandbox", "--disable-gpu"]
   }
   ```

3. If both browser-based approaches fail, generate an SVG alternative:
   - Use `npx @mermaid-js/mermaid-cli -i docs/architecture.mmd -o docs/architecture.svg` (SVG may work without a full browser)
   - Or create a clean SVG manually from the Mermaid source

4. Verify the output file exists and is a valid image:
   ```bash
   file docs/architecture.png
   ls -la docs/architecture.png
   ```
   File must be >5KB (a real rendered diagram, not an empty/error file).

**Important:** Clean up any temporary scripts after rendering. Do NOT modify `docs/architecture.mmd` — it is already verified as correct.
  </action>
  <verify>
```bash
test -f docs/architecture.png && ls -la docs/architecture.png && file docs/architecture.png
```
File exists, is >5KB, and `file` reports it as a PNG image (or valid image format).
  </verify>
  <done>
`docs/architecture.png` exists as a valid image file showing the Indagine architecture diagram with all 8 agents and data flow arrows.
  </done>
</task>

</tasks>

<verification>
- `docs/architecture.png` exists and is >5KB
- `file docs/architecture.png` reports valid image format
- Optional: open `docs/architecture.png` to confirm it is readable and complete
</verification>

<success_criteria>
A submission-ready architecture diagram PNG exists at `docs/architecture.png` that shows all 8 Indagine agents with data flow, closing VERIFICATION gap 1 (DEMO-04).
</success_criteria>

<output>
After completion, create `.planning/phases/04-demo-submit/04-04-SUMMARY.md`
</output>
