---
phase: 05-perfect-stack
plan: "01"
type: execute
wave: 1
depends_on:
  - 04-demo-submit
files_modified:
  - pyproject.toml
  - uv.lock
  - README.md
  - requirements.txt
autonomous: true
user_setup: []
must_haves:
  truths:
    - "pyproject.toml is the single source of truth for dependencies"
    - "uv workflow is the default local dev path (uv sync / uv run ...)"
  artifacts:
    - path: "pyproject.toml"
      provides: "PEP 621 dependencies + tool config"
    - path: "uv.lock"
      provides: "Reproducible dependency resolution"
---

<objective>
Migrate Indagine to the 'perfect' Python stack for packaging/reproducibility and DX, without changing runtime behavior.

Definition of done:
- `pyproject.toml` is the single source of truth for deps (no `requirements.txt` needed)
- Use `uv` workflow with committed `uv.lock`
- Dev tooling: ruff + pytest configured in `pyproject.toml`
- README uses `uv sync` / `uv run ...`
- `uv run pytest` passes
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@pyproject.toml
@requirements.txt
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move dependencies into pyproject and generate uv.lock</name>
  <files>
pyproject.toml
uv.lock
requirements.txt
  </files>
  <action>
- Encode runtime dependencies in `pyproject.toml` (PEP 621), matching the current `requirements.txt` behavior.
- Ensure dev dependencies (pytest, ruff) are in a dev group so `uv run pytest` works.
- Add minimal build metadata only if required for `uv sync` to succeed without flags.
- Generate and commit `uv.lock`.
  </action>
  <verify>
uv lock
uv sync
uv run python -c "import jsonschema, pydantic"
  </verify>
  <done>
- `uv sync` succeeds from a clean checkout
- `uv.lock` is present and reflects the project dependencies
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure dev tooling in pyproject (ruff + pytest)</name>
  <files>
pyproject.toml
  </files>
  <action>
- Keep ruff and pytest configuration in `pyproject.toml`.
- Ensure `uv run ruff` and `uv run pytest` work in a freshly synced environment.
  </action>
  <verify>
uv run ruff check .
uv run pytest -q
  </verify>
  <done>
- Lint + tests run via `uv run ...` using the locked environment
  </done>
</task>

<task type="auto">
  <name>Task 3: Update README to use uv workflow and remove requirements.txt setup</name>
  <files>
README.md
requirements.txt
  </files>
  <action>
- Update README setup instructions to use `uv sync`.
- Update all README run commands to use `uv run ...`.
- Remove `requirements.txt` if no longer needed.
  </action>
  <verify>
uv run pytest -q
  </verify>
  <done>
- README reflects uv-based setup and execution
- `requirements.txt` is not required for install/run
  </done>
</task>

</tasks>

<verification>
- `uv sync` succeeds
- `uv run pytest -q` exits 0
</verification>

<success_criteria>
- Dependencies are declared in `pyproject.toml` only
- `uv.lock` is committed for reproducibility
- Contributors can follow README with `uv sync` and `uv run ...`
</success_criteria>

<output>
After completion, create `.planning/phases/05-perfect-stack/05-01-SUMMARY.md`
</output>
